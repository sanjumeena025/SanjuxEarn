<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - SanjuxEarn</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 500px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            margin: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        .points-display {
            font-size: 24px;
            font-weight: bold;
            color: #ff5722;
            margin: 20px 0;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .logout-btn {
            background: #f44336;
            padding: 8px 16px;
            font-size: 14px;
        }
        .profile-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ SanjuxEarn</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        
        <div class="profile-section">
            <p>Welcome, <span id="userName">User</span>!</p>
            <p>Email: <span id="userEmail">user@example.com</span></p>
            <button onclick="showChangePassword()" style="background: #2196F3;">Change Password</button>
        </div>
        
        <div class="points-display" id="points">0 Points</div>
        
        <button onclick="earnPoints(10)">üì∫ Watch Ad (+10 Points)</button>
        <button onclick="earnPoints(5)">üìù Survey (+5 Points)</button>
        <button onclick="earnPoints(20)">üéÆ Play Game (+20 Points)</button>
        
        <br>
        <button onclick="redeemPoints()" style="background: #ff9800;">üíµ Redeem 100 Points = ‚Çπ1</button>
        
        <!-- Change Password Form -->
        <div id="change-password-form" style="display: none; margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <h3>Change Password</h3>
            <input type="password" id="current-password" placeholder="Current Password" style="width: 100%; padding: 10px; margin: 5px 0;">
            <input type="password" id="new-password" placeholder="New Password" style="width: 100%; padding: 10px; margin: 5px 0;">
            <input type="password" id="confirm-password" placeholder="Confirm New Password" style="width: 100%; padding: 10px; margin: 5px 0;">
            <button onclick="changePassword()" style="background: #2196F3;">Update Password</button>
            <button onclick="hideChangePassword()" style="background: #666;">Cancel</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <script>
        // YOUR FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyAIDSXHGs08fFBfbgzjeiaPhiYC",
            authDomain: "sanjuxearn-fa7ab.firebaseapp.com",
            projectId: "sanjuxearn-fa7ab",
            storageBucket: "sanjuxearn-fa7ab.appspot.com",
            messagingSenderId: "633583614314",
            appId: "1:633583614314:web:d891a3a159b170",
            measurementId: "G-06BY41FQ6L"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let userPoints = 0;

        // Check authentication
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('userName').textContent = user.displayName || user.email;
                document.getElementById('userEmail').textContent = user.email;
                
                // Load user points
                await loadUserPoints();
            } else {
                window.location.href = 'index.html';
            }
        });

        async function loadUserPoints() {
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    userPoints = doc.data().points || 0;
                    updateDisplay();
                }
            } catch (error) {
                console.error('Error loading points:', error);
            }
        }

        async function earnPoints(amount) {
            userPoints += amount;
            await updateFirestorePoints();
            updateDisplay();
            alert(`üéâ +${amount} Points! Total: ${userPoints}`);
        }

        async function redeemPoints() {
            if (userPoints >= 100) {
                userPoints -= 100;
                await updateFirestorePoints();
                updateDisplay();
                alert('‚úÖ ‚Çπ1 redeemed successfully!');
            } else {
                alert('‚ùå You need at least 100 points to redeem!');
            }
        }

        async function updateFirestorePoints() {
            try {
                await db.collection('users').doc(currentUser.uid).update({
                    points: userPoints
                });
            } catch (error) {
                console.error('Error updating points:', error);
            }
        }

        function updateDisplay() {
            document.getElementById('points').textContent = userPoints + ' Points';
        }

        function showChangePassword() {
            document.getElementById('change-password-form').style.display = 'block';
        }

        function hideChangePassword() {
            document.getElementById('change-password-form').style.display = 'none';
        }

        async function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }

            try {
                // Re-authenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email, 
                    currentPassword
                );
                await currentUser.reauthenticateWithCredential(credential);
                
                // Update password
                await currentUser.updatePassword(newPassword);
                alert('Password updated successfully!');
                hideChangePassword();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function logout() {
            auth.signOut();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>